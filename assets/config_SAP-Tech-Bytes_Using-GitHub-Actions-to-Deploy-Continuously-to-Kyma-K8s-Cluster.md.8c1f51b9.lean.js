import{_ as n,c as t,o as a,a as e,b as s}from"./app.80f3e7ce.js";var o="/my-SAP-exercises-with-VSCode/assets/4-build-the-image.b75b044c.png",l="/my-SAP-exercises-with-VSCode/assets/5-tag-image.e3ab7000.png",r="/my-SAP-exercises-with-VSCode/assets/5-regcred.d3386713.png",i="/my-SAP-exercises-with-VSCode/assets/7-secrets.5c9ceb49.png",c="/my-SAP-exercises-with-VSCode/assets/8-package-created.65cc0c78.png",u="/my-SAP-exercises-with-VSCode/assets/11-Hello-SAP-Tech-Bytes.6a221d64.png",p="/my-SAP-exercises-with-VSCode/assets/12-release.62b5ad11.png";const ye='{"title":"Using GitHub Actions to Deploy Continuously to Kyma/Kubernetes","description":"Using GitHub Actions to build a CI/CD pipeline that deploys to your SAP BTP Kyma cluster","frontmatter":{"sidebarDepth":3,"head":[["meta",{"name":"title","content":"Using GitHub Actions to Deploy Continuously to Kyma/Kubernetes"}],["meta",{"name":"description","content":"Using GitHub Actions to build a CI/CD pipeline that deploys to your SAP BTP Kyma cluster"}],["meta",{"name":"keywords","content":"SAP HANA BTP, GitHub Actions, CAP, K8s, Kyma, Kubernetes, VS Code Dev Container"}]]},"headers":[{"level":2,"title":"Preparations","slug":"preparations"},{"level":2,"title":"Dockerize the App","slug":"dockerize-the-app"},{"level":2,"title":"Update your .kube/config","slug":"update-your-kube-config"},{"level":2,"title":"The Kyma Manifest","slug":"the-kyma-manifest"},{"level":2,"title":"Set up the GitHub Repository","slug":"set-up-the-github-repository"},{"level":2,"title":"Create Two GitHub Workflows","slug":"create-two-github-workflows"},{"level":2,"title":"This is what happen when you trigger the deployment.yaml file (.github/workflows/deploy.yaml)","slug":"this-is-what-happen-when-you-trigger-the-deployment-yaml-file-github-workflows-deploy-yaml"},{"level":2,"title":"Trigger the Pipeline","slug":"trigger-the-pipeline"},{"level":2,"title":"Kudos to Marius Obert for this great technical article","slug":"kudos-to-marius-obert-for-this-great-technical-article"}],"relativePath":"config/SAP-Tech-Bytes/Using-GitHub-Actions-to-Deploy-Continuously-to-Kyma-K8s-Cluster.md","lastUpdated":1637069977803}',h={},d=e("h1",{id:"using-github-actions-to-deploy-continuously-to-kyma-kubernetes",tabindex:"-1"},[s("Using GitHub Actions to Deploy Continuously to Kyma/Kubernetes "),e("a",{class:"header-anchor",href:"#using-github-actions-to-deploy-continuously-to-kyma-kubernetes","aria-hidden":"true"},"#")],-1),b=e("ul",null,[e("li",null,[e("p",null,[e("a",{href:"https://blogs.sap.com/2021/08/02/sap-tech-bytes-using-github-actions-to-deploy-continuously-to-kyma-kubernetes/?source=social-Global-sap-developers-LINKEDIN_COMPANY-MarketingCampaign-Developers-Business+Technology+Platform+Umbrella-spr-5262938156&campaigncode=CRM-XB21-MKT-DGEALL",target:"_blank",rel:"noopener noreferrer"},"Using GitHub Actions to Deploy Continuously to Kyma/Kubernetes"),s(" with this "),e("a",{href:"https://github.com/draschke/dr-sap-tech-bytes-2021-08-02/blob/b108204e237e3c48998ab65a20cc5026afe36b9c/.devcontainer",target:"_blank",rel:"noopener noreferrer"},"VS Dev Container")])]),e("li",null,[e("p",null,[s("If you use this "),e("a",{href:"https://github.com/draschke/dr-sap-tech-bytes-2021-08-02/blob/b108204e237e3c48998ab65a20cc5026afe36b9c/.devcontainer",target:"_blank",rel:"noopener noreferrer"},"VS Dev Container"),s(" you can follow all the steps without having to install any further program. This walkthrough only provides my additional quidance for this awesome tutorial from Marius Obert.")])])],-1),m=e("h2",{id:"preparations",tabindex:"-1"},[s("Preparations "),e("a",{class:"header-anchor",href:"#preparations","aria-hidden":"true"},"#")],-1),g=e("ul",null,[e("li",null,[s("Clone this "),e("a",{href:"https://github.com/draschke/dr-sap-tech-bytes-2021-08-02.git",target:"_blank",rel:"noopener noreferrer"},"repo"),s(" in a new WSL folder and start the included Dev Container")])],-1),k=e("h2",{id:"dockerize-the-app",tabindex:"-1"},[s("Dockerize the App "),e("a",{class:"header-anchor",href:"#dockerize-the-app","aria-hidden":"true"},"#")],-1),y=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s("node \u279C /workspaces/sap-tech-bytes "),e("span",{class:"token punctuation"},"("),e("span",{class:"token number"},"2021"),s("-08-02-github-actions-kyma"),e("span",{class:"token punctuation"},")"),s(`
$ docker build -t sap-tech-bytes `),e("span",{class:"token builtin class-name"},"."),s(`
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br")])],-1),_=e("p",null,[e("img",{src:o,alt:"cap-kyma-app"})],-1),f=e("ul",null,[e("li",null,"Tag the image with your registry account user")],-1),w=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s("node \u279C /workspaces/sap-tech-bytes "),e("span",{class:"token punctuation"},"("),e("span",{class:"token number"},"2021"),s("-08-02-github-actions-kyma"),e("span",{class:"token punctuation"},")"),s(` 
$ docker tag dr-sap-tech-bytes:latest draschke/dr-sap-tech-bytes

output--`),e("span",{class:"token operator"},">"),s(` draschke/dr-sap-tech-bytes:latest
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br")])],-1),v=e("p",null,[e("img",{src:l,alt:"cap-kyma-app"})],-1),C=e("h2",{id:"update-your-kube-config",tabindex:"-1"},[s("Update your .kube/config "),e("a",{class:"header-anchor",href:"#update-your-kube-config","aria-hidden":"true"},"#")],-1),A=e("ul",null,[e("li",null,"Update your .kube/config (after 8 hours you will have to change it again)")],-1),K=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s(),e("span",{class:"token function"},"cp"),s(" ."),e("span",{class:"token punctuation"},"\\"),s(`kubeconfig.yaml  ~/.kube/config
 `),e("span",{class:"token comment"},"#find your directory here"),s(`
`),e("span",{class:"token punctuation"},"\\"),e("span",{class:"token punctuation"},"\\"),s("wsl$"),e("span",{class:"token punctuation"},"\\"),s("Ubuntu-20.04"),e("span",{class:"token punctuation"},"\\"),s("home"),e("span",{class:"token punctuation"},"\\"),e("span",{class:"token operator"},"<"),s("youruser"),e("span",{class:"token operator"},">"),e("span",{class:"token punctuation"},"\\"),s(`.kube
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br")])],-1),P=e("ul",null,[e("li",null,[s("or do it better and follow this nice guide from Marius "),e("a",{href:"https://developers.sap.com/tutorials/kyma-create-service-account.html",target:"_blank",rel:"noopener noreferrer"},"Create a Kyma service account")])],-1),S=e("h2",{id:"the-kyma-manifest",tabindex:"-1"},[s("The Kyma Manifest "),e("a",{class:"header-anchor",href:"#the-kyma-manifest","aria-hidden":"true"},"#")],-1),T=e("ul",null,[e("li",null,"Make sure you are logged in to kubectl by running one of this commands")],-1),x=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s("node \u279C /workspaces/sap-tech-bytes "),e("span",{class:"token punctuation"},"("),e("span",{class:"token number"},"2021"),s("-08-02-github-actions-kyma"),e("span",{class:"token punctuation"},")"),s(`
$ kubectl get ns
$ kubectl get pods
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br")])],-1),D=e("ul",null,[e("li",null,"Change the dev_deployment.yaml")],-1),G=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[e("span",{class:"token comment"},"#image: ghcr.io/<user>/<repo name>:latest"),s(`
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br")])],-1),U=e("ul",null,[e("li",null,'Create secret \u201Cregcred\u201C (Take care that you have a namespace "tutorial")')],-1),H=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s("node \u279C /workspaces/sap-tech-bytes "),e("span",{class:"token punctuation"},"("),e("span",{class:"token number"},"2021"),s("-08-02-github-actions-kyma"),e("span",{class:"token punctuation"},")"),s(`

$ kubectl -n tutorial create secret docker-registry regcred --docker-server`),e("span",{class:"token operator"},"="),s("https://ghcr.io  --docker-username"),e("span",{class:"token operator"},"="),e("span",{class:"token operator"},"<"),s("github user"),e("span",{class:"token operator"},">"),s("  --docker-password"),e("span",{class:"token operator"},"="),e("span",{class:"token operator"},"<"),s("github personal access token"),e("span",{class:"token operator"},">"),s(`
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br")])],-1),$=e("ul",null,[e("li",null,`After creating the secret "regcred" you'll find it here`)],-1),B=e("p",null,[e("img",{src:r,alt:"docker registry credentials"})],-1),V=e("h2",{id:"set-up-the-github-repository",tabindex:"-1"},[s("Set up the GitHub Repository "),e("a",{class:"header-anchor",href:"#set-up-the-github-repository","aria-hidden":"true"},"#")],-1),E=e("ul",null,[e("li",null,"Go to your kubeconfig.yml and export a base64 value file and paste it to your git repository secrets")],-1),I=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[e("span",{class:"token punctuation"},"\\"),e("span",{class:"token punctuation"},"\\"),s("wsl$"),e("span",{class:"token punctuation"},"\\"),s("Ubuntu-20.04"),e("span",{class:"token punctuation"},"\\"),s("home"),e("span",{class:"token punctuation"},"\\"),e("span",{class:"token operator"},"<"),s("user"),e("span",{class:"token operator"},">"),e("span",{class:"token punctuation"},"\\"),s(".kube"),e("span",{class:"token punctuation"},"\\"),s(`kubeconfig.yml
`),e("span",{class:"token function"},"cat"),s(" kubeconfig.yaml "),e("span",{class:"token operator"},"|"),s(" base64 "),e("span",{class:"token operator"},">"),s(` base64-kubeconfig.txt
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br")])],-1),M=e("ul",null,[e("li",null,[s("Create a repo secret "),e("code",null,"DEV_KUBECONFIG"),s(" with the base64 value")])],-1),N=e("p",null,[e("img",{src:i,alt:"cap-kyma-app"})],-1),O=e("h2",{id:"create-two-github-workflows",tabindex:"-1"},[s("Create Two GitHub Workflows "),e("a",{class:"header-anchor",href:"#create-two-github-workflows","aria-hidden":"true"},"#")],-1),R=e("ul",null,[e("li",null,"Change the name of your image")],-1),z=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,`.github/workflows/deploy.yaml
  IMAGE_NAME: sap-samples/tech-bytes-kyma-cicd
`)]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br")])],-1),L=e("ul",null,[e("li",null,"You need your GITHUB_TOKEN")],-1),F=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s("password: "),e("span",{class:"token variable"},"${{ secrets.GITHUB_TOKEN }"),e("span",{class:"token punctuation"},"}"),s(`
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br")])],-1),W=e("ul",null,[e("li",null,"You need your DEV_KUBECONFIG")],-1),Y=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s(" config: "),e("span",{class:"token variable"},"${{ secrets.DEV_KUBECONFIG }"),e("span",{class:"token punctuation"},"}"),s(`
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br")])],-1),j=e("h2",{id:"this-is-what-happen-when-you-trigger-the-deployment-yaml-file-github-workflows-deploy-yaml",tabindex:"-1"},[s("This is what happen when you trigger the deployment.yaml file (.github/workflows/deploy.yaml) "),e("a",{class:"header-anchor",href:"#this-is-what-happen-when-you-trigger-the-deployment-yaml-file-github-workflows-deploy-yaml","aria-hidden":"true"},"#")],-1),q=e("ol",null,[e("li",null,"Load metadata from the Dockerfile"),e("li",null,"Build the image"),e("li",null,"Push the image to the registry"),e("li",null,"Read the kubeconfig from the secret we created and deploy the image to your Kyma cluster.")],-1),X=e("ul",null,[e("li",null,"Packages on the right side")],-1),J=e("p",null,[e("img",{src:c,alt:"cap-kyma-app"})],-1),Q=e("ul",null,[e("li",null,"Check if your app is running (If not keep an eye at your Pods (error logs / credentials))")],-1),Z=e("p",null,[e("img",{src:u,alt:"cap-kyma-app"})],-1),ee=e("h2",{id:"trigger-the-pipeline",tabindex:"-1"},[s("Trigger the Pipeline "),e("a",{class:"header-anchor",href:"#trigger-the-pipeline","aria-hidden":"true"},"#")],-1),se=e("ul",null,[e("li",null,"Increase the version")],-1),ne=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s("node \u279C /workspaces/sap-tech-bytes "),e("span",{class:"token punctuation"},"("),s("dr-sap-tech-bytes-2021-08-02"),e("span",{class:"token punctuation"},")"),s(` 
$ `),e("span",{class:"token function"},"npm"),s(` version patch
v1.1.3 
node \u279C /workspaces/sap-tech-bytes `),e("span",{class:"token punctuation"},"("),s("dr-sap-tech-bytes-2021-08-02"),e("span",{class:"token punctuation"},")"),s(` 
$ `),e("span",{class:"token function"},"git"),s(` push --follow-tags
`),e("span",{class:"token punctuation"},".."),s(`.
 * `),e("span",{class:"token punctuation"},"["),s("new tag"),e("span",{class:"token punctuation"},"]"),s("         v1.1.3 -"),e("span",{class:"token operator"},">"),s(` v1.1.3
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br")])],-1),te=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s(`Have had this issue: 
node \u279C /workspaces/sap-tech-bytes `),e("span",{class:"token punctuation"},"("),s("dr-sap-tech-bytes-2021-08-02 \u2717"),e("span",{class:"token punctuation"},")"),s(` 
$ `),e("span",{class:"token function"},"npm"),s(` version patch 
Output `),e("span",{class:"token comment"},"#npm ERR! Git working directory not clean."),s(`
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br")])],-1),ae=e("div",{class:"language-bash line-numbers-mode"},[e("pre",null,[e("code",null,[s(`Solution:
node \u279C /workspaces/sap-tech-bytes `),e("span",{class:"token punctuation"},"("),s("dr-sap-tech-bytes-2021-08-02 \u2717"),e("span",{class:"token punctuation"},")"),s(` 
$ `),e("span",{class:"token function"},"npm"),s(` version --no-git-tag-version
After that you should be fine
`)])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br")])],-1),oe=e("ul",null,[e("li",null,"Update the current deployment to make use of the latest image")],-1),le=e("p",null,[s("The "),e("a",{href:"https://github.com/draschke/dr-sap-tech-bytes-2021-08-02/blob/85a1177577c438b1e23d7a7b96ab5e34eb3638b7/.github/workflows/publish.yaml",target:"_blank",rel:"noopener noreferrer"},"publish.yaml file"),s(" includes a nice Action to keep your releases updated")],-1),re=e("p",null,[e("img",{src:p,alt:"cap-kyma-app"})],-1),ie=e("h2",{id:"kudos-to-marius-obert-for-this-great-technical-article",tabindex:"-1"},[s("Kudos to Marius Obert for this great technical article "),e("a",{class:"header-anchor",href:"#kudos-to-marius-obert-for-this-great-technical-article","aria-hidden":"true"},"#")],-1),ce=[d,b,m,g,k,y,_,f,w,v,C,A,K,P,S,T,x,D,G,U,H,$,B,V,E,I,M,N,O,R,z,L,F,W,Y,j,q,X,J,Q,Z,ee,se,ne,te,ae,oe,le,re,ie];function ue(pe,he,de,be,me,ge){return a(),t("div",null,ce)}var _e=n(h,[["render",ue]]);export{ye as __pageData,_e as default};
